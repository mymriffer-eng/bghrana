{% extends 'catalog/base.html' %}
{% block content %}
<style>
.new-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 3px 10px rgba(255, 82, 82, 0.4);
    z-index: 10;
    animation: pulse 2s infinite;
}
@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}
.expiry-badge {
    background-color: #28a745;
    color: white;
    padding: 0.3rem 0.6rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-block;
    margin-top: 0.5rem;
}
.expiry-soon {
    background-color: #ffc107;
    color: #333;
}
.expiry-expired {
    background-color: #dc3545;
    color: white;
}
.expired-card {
    opacity: 0.7;
    border: 2px solid #dc3545;
}
.stats-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 10px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}
.stats-box h4 {
    margin: 0;
    font-size: 1.1rem;
}
.stats-box .stats-numbers {
    display: flex;
    gap: 2rem;
    margin-top: 1rem;
}
.stats-box .stat-item {
    text-align: center;
}
.stats-box .stat-number {
    font-size: 2rem;
    font-weight: bold;
}
.stats-box .stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}
</style>
<div class="container mt-5">
  <h2>–ú–æ–∏—Ç–µ –æ–±—è–≤–∏</h2>
  
  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="stats-box">
    <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
    <div class="stats-numbers">
      <div class="stat-item">
        <div class="stat-number">{{ products|length }}</div>
        <div class="stat-label">–û–±—â–æ –æ–±—è–≤–∏</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">{{ active_count }}</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∏</div>
      </div>
      {% if expired_count > 0 %}
      <div class="stat-item">
        <div class="stat-number">{{ expired_count }}</div>
        <div class="stat-label">–ò–∑—Ç–µ–∫–ª–∏</div>
      </div>
      {% endif %}
    </div>
  </div>
  
  <a href="{% url 'catalog:product_create' %}" class="btn btn-success mb-3">+ –ù–æ–≤–∞ –æ–±—è–≤–∞</a>
  
  <div class="row g-4">
    {% for product in products %}
    <div class="col-md-4">
      <div class="card {% if product.is_expired %}expired-card{% endif %}" style="position: relative;">
        {% if product.is_new and not product.is_expired %}
        <span class="new-badge">üÜï –ù–û–í–ê</span>
        {% endif %}
        {% if product.get_first_image %}<img src="{{ product.get_first_image.url }}" class="card-img-top">{% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ product.title }}</h5>
          <p class="card-text">{{ product.description|truncatewords:15 }}</p>
          <p class="mb-1"><strong>–¶–µ–Ω–∞:</strong> {{ product.price }} ‚Ç¨</p>
          
          {% with days=product.days_remaining %}
          {% if days == 0 %}
            <span class="expiry-badge expiry-expired">‚ùå –ò–ó–¢–ï–ö–õ–ê</span>
          {% elif days <= 5 %}
            <span class="expiry-badge expiry-soon">‚ö†Ô∏è –ò–∑—Ç–∏—á–∞ —Å–ª–µ–¥ {{ days }} –¥–Ω–∏!</span>
          {% else %}
            <span class="expiry-badge">‚úì –ê–∫—Ç–∏–≤–Ω–∞ ({{ days }} –¥–Ω–∏)</span>
          {% endif %}
          {% endwith %}
          
          <div class="mt-3">
            {% if product.is_expired %}
              <!-- –ë—É—Ç–æ–Ω–∏ –∑–∞ –∏–∑—Ç–µ–∫–ª–∞ –æ–±—è–≤–∞ -->
              <a href="{% url 'catalog:product_reactivate' product.pk %}" class="btn btn-sm btn-success w-100 mb-2">
                üîÑ –†–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–π –∑–∞ 30 –¥–Ω–∏
              </a>
              <a href="{% url 'catalog:product_delete' product.pk %}" class="btn btn-sm btn-danger w-100">–ò–∑—Ç—Ä–∏–π</a>
            {% else %}
              <!-- –ë—É—Ç–æ–Ω–∏ –∑–∞ –∞–∫—Ç–∏–≤–Ω–∞ –æ–±—è–≤–∞ -->
              <a href="{% url 'catalog:product_update' product.pk %}" class="btn btn-sm btn-primary">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</a>
              <a href="{% url 'catalog:product_delete' product.pk %}" class="btn btn-sm btn-danger">–ò–∑—Ç—Ä–∏–π</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-info">
        <h5>–ù—è–º–∞—à –ø—É–±–ª–∏–∫—É–≤–∞–Ω–∏ –æ–±—è–≤–∏</h5>
        <p>–ó–∞–ø–æ—á–Ω–∏ —Å–µ–≥–∞, –∫–∞—Ç–æ —Å—ä–∑–¥–∞–¥–µ—à —Ç–≤–æ—è—Ç–∞ –ø—ä—Ä–≤–∞ –æ–±—è–≤–∞!</p>
        <a href="{% url 'catalog:product_create' %}" class="btn btn-success">–°—ä–∑–¥–∞–π –æ–±—è–≤–∞</a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}