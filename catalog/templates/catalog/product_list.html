{% load static %}
<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-534QBB36');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Google Consent Mode v2 -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      
      // Default consent state (denied until user accepts)
      gtag('consent', 'default', {
        'analytics_storage': 'denied',
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'wait_for_update': 500
      });
      
      // Check if user already gave consent
      if (localStorage.getItem('cookie_consent') === 'true') {
        gtag('consent', 'update', {
          'analytics_storage': 'granted'
        });
      }
    </script>
    
    <!-- SEO Canonical -->
    <link rel="canonical" href="{% if canonical_url %}{{ canonical_url }}{% else %}https://bghrana.com/{% endif %}">
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="{% if page_description %}{{ page_description }}{% else %}–ù–∞–π-—Å–≤–µ–∂–∏—Ç–µ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–∏ –æ—Ä–≥–∞–Ω–∏—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏—Ç–µ. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–∞ –æ–±—è–≤–∏ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ —Ö—Ä–∞–Ω–∏ –æ—Ç —Ü—è–ª–∞ –ë—ä–ª–≥–∞—Ä–∏—è.{% endif %}">
    <meta name="theme-color" content="#0dd843">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ë–ì –•—Ä–∞–Ω–∞">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="192x192" href="{% static 'icons/icon-192x192.png' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <title>{% if page_title %}{{ page_title }} - –ë–ì –•—Ä–∞–Ω–∞{% else %}–ë–ì –•—Ä–∞–Ω–∞ - –ë—ä–ª–≥–∞—Ä—Å–∫–∞ —Ö—Ä–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è{% endif %}</title>
    <style>
        :root {
            --primary-color: #0dd843;
            --primary-hover: #0bc239;
            --footer-bg: #2c3e50;
            --bg-color: #8cf973;
            --text-color: #212529;
            --card-bg: #ffffff;
        }
        
        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #e9ecef;
            --card-bg: #2d2d2d;
            --footer-bg: #0d1117;
        }
        
        * {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body { 
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .navbar { 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1030;
            transition: all 0.3s ease;
        }
        
        .navbar.scrolled {
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        /* –ù–∞–º–∞–ª—è–≤–∞–Ω–µ –Ω–∞ —à–∏—Ä–æ—á–∏–Ω–∞—Ç–∞ —Å –æ–±—â–æ 19% */
        .container {
            max-width: 972px !important; /* 1200px - 19% = 972px */
        }
        @media (min-width: 1400px) {
            .container {
                max-width: 1134px !important; /* 1400px - 19% = 1134px */
            }
        }
        
        /* Hero buttons - –∞–¥–∞–ø—Ç–∏–≤–Ω–∏ —Ä–∞–∑–º–µ—Ä–∏ */
        .hero-btn {
            font-size: 1.25rem;
            padding: 0.75rem 3rem;
        }
        @media (max-width: 768px) {
            .hero-btn {
                font-size: 1rem;
                padding: 0.6rem 1.5rem;
                width: 100%;
            }
            .hero-section h1 {
                font-size: 1.75rem !important;
            }
            .hero-section h2 {
                font-size: 1rem !important;
            }
        }
        @media (max-width: 576px) {
            .hero-btn {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }
        }
        
        .product-card { 
            transition: all 0.3s ease; 
            border: none; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            border-radius: 15px; 
            overflow: hidden;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        .product-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }
        .product-image { width: 100%; height: 200px; object-fit: cover; background-color: #e9ecef; }
        .price { color: var(--primary-color); font-weight: 700; font-size: 20px; }
        .category-badge { 
            display: inline-block; 
            padding: 0.4rem 0.9rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white; 
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .hero-section { background: linear-gradient(135deg, #0dd843 0%, #28a745 100%); color: white; padding: 60px 0; border-radius: 10px; margin-bottom: 40px; }
        .hero-section h1 { font-size: 48px; font-weight: bold; margin-bottom: 20px; }
        .filter-section { 
            background-color: #ffa954; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 30px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        [data-theme="dark"] .filter-section {
            background-color: #2d2d2d;
        }
        [data-theme="dark"] .filter-section label {
            color: #e9ecef;
        }
        .filter-btn { 
            margin-right: 10px; 
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .filter-btn.active { 
            background-color: var(--primary-color) !important; 
            color: white;
            box-shadow: 0 4px 8px rgba(13, 216, 67, 0.3);
        }
        .pagination .page-link { color: #0dd843; }
        .pagination .page-link:hover { background-color: #0dd843; color: white; }
        .pagination .active .page-link { background-color: #0dd843; border-color: #0dd843; color: white; }
        
        /* –ó–∞–æ–±–ª–µ–Ω–∏ –ø–∞–¥–∞—â–∏ –º–µ–Ω—é—Ç–∞ */
        .form-select {
            border-radius: 10px !important;
            border: 2px solid #0dd843;
            padding: 10px 15px;
            background-color: white;
            color: #212529;
        }
        [data-theme="dark"] .form-select {
            background-color: #3d3d3d;
            color: #e9ecef;
        }
        .form-select:focus {
            border-color: #0dd843;
            box-shadow: 0 0 0 0.2rem rgba(13, 216, 67, 0.25);
        }
        /* –°—Ç–∏–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –æ–ø—Ü–∏–∏—Ç–µ –≤ –º–µ–Ω—é—Ç–æ */
        .form-select option {
            padding: 10px;
            border-radius: 5px;
            background-color: white;
        }
        .form-select option:hover {
            background-color: #0dd843;
            color: white;
        }
        .form-select option:checked {
            background-color: #0dd843;
            color: white;
        }
        
        /* Custom Dropdown Styles */
        .custom-select-wrapper {
            position: relative;
            width: 100%;
        }
        .custom-select {
            background-color: white;
            color: #212529;
            border: 2px solid #0dd843;
            border-radius: 10px;
            padding: 10px 35px 10px 15px;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        [data-theme="dark"] .custom-select {
            background-color: #3d3d3d;
            color: #e9ecef;
        }
        .custom-select:after {
            content: '‚ñº';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #0dd843;
            pointer-events: none;
        }
        .custom-select.active:after {
            content: '‚ñ≤';
        }
        .custom-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 2px solid #0dd843;
            border-radius: 10px;
            margin-top: 5px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        [data-theme="dark"] .custom-options {
            background-color: #3d3d3d;
        }
        .custom-options.show {
            display: block;
        }
        .custom-option {
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #212529;
        }
        [data-theme="dark"] .custom-option {
            color: #e9ecef;
        }
        .custom-option:hover {
            background-color: #0dd843;
            color: white;
        }
        .custom-option.selected {
            background-color: #e8f8ed;
            font-weight: bold;
        }
        .custom-option:first-child {
            border-radius: 8px 8px 0 0;
        }
        .custom-option:last-child {
            border-radius: 0 0 8px 8px;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-534QBB36"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <nav class="navbar navbar-expand-lg" style="background-color: #0dd843;" data-bs-theme="light" sticky-top>
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="{% url 'catalog:product_list' %}">
                <img src="{% static 'logo.jpg' %}" alt="–õ–æ–≥–æ" style="height: 40px; width: auto; margin-right: 10px; border-radius: 5px;">
                –ë–ì –•—Ä–∞–Ω–∞
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" href="{% url 'catalog:product_list' %}">–ù–∞—á–∞–ª–æ</a></li>
                </ul>
                <ul class="navbar-nav align-items-lg-center">
                    {% if user.is_authenticated %}
                    <li class="nav-item"><a class="nav-link" href="{% url 'catalog:user_profile' %}">–ü—Ä–æ—Ñ–∏–ª</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'catalog:user_ads' %}">–ú–æ–∏—Ç–µ –æ–±—è–≤–∏</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'catalog:product_create' %}">–ù–æ–≤–∞ –æ–±—è–≤–∞</a></li>
                    <li class="nav-item d-flex align-items-center">
                        <form method="post" action="{% url 'catalog:logout' %}" class="d-inline m-0">
                            {% csrf_token %}
                            <button type="submit" class="btn" style="background-color: #ffcccc; color: #dc3545; border: 1px solid #ff9999; border-radius: 4px; font-size: 0.875rem; padding: 0.25rem 0.5rem;">–ò–∑—Ö–æ–¥</button>
                        </form>
                    </li>
                    {% else %}
                    <li class="nav-item"><a class="nav-link" href="{% url 'account_login' %}">–í—Ö–æ–¥</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'catalog:register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                    {% endif %}
                </ul>
                <button id="installAppNavbar" class="btn ms-lg-2 me-2 my-2 my-lg-0" style="background-color: #fffacd; color: #333; border: 1px solid #f0e68c; border-radius: 4px; font-size: 0.875rem; padding: 0.25rem 0.5rem;">
                    üì± –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π
                </button>
                <form class="d-flex mt-2 mt-lg-0" role="search" method="get" id="search-form">
                    <input class="form-control me-2" type="search" placeholder="–¢—ä—Ä—Å–∏..." name="search" value="{{ search_query }}" style="max-width: 200px; font-size: 0.875rem;" />
                    <button class="btn btn-outline-light" type="submit" style="font-size: 0.875rem; padding: 0.25rem 0.75rem;">–¢—ä—Ä—Å–∏</button>
                </form>
                <!-- Dark Mode Toggle -->
                <button id="darkModeToggle" class="btn btn-outline-light ms-2 mt-2 mt-lg-0" title="–ü—Ä–µ–≤–∫–ª—é—á–∏ —Ç—ä–º–µ–Ω —Ä–µ–∂–∏–º" style="font-size: 0.875rem; padding: 0.25rem 0.75rem;">
                    <span class="dark-mode-icon">üåô</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section with Background Image -->
    <div class="container mt-4 mb-0">
        <div class="hero-section position-relative overflow-hidden" style="
            background-image: url('/media/products/bghrana.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 60vh;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
        ">
            <!-- Dark Overlay -->
            <div class="position-absolute top-0 start-0 w-100 h-100" style="background-color: rgba(0, 0, 0, 0.45); border-radius: 20px;"></div>
            
            <!-- Content -->
            <div class="position-relative text-center text-white px-4 py-5">
                <h1 class="display-3 fw-bold mb-4" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);">
                    {% if page_title %}{{ page_title }}{% else %}–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–∞ –æ–±—è–≤–∏ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏{% endif %}
                </h1>
                <h2 class="fs-3 mb-4" style="text-shadow: 2px 2px 6px rgba(0,0,0,0.7);">
                    –ë–µ–∑–ø–ª–∞—Ç–Ω–∏ –æ–±—è–≤–∏ –∑–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∞ —Ö—Ä–∞–Ω–∞ ‚Äì –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç —Ö–æ—Ä–∞—Ç–∞, –∫–æ–∏—Ç–æ —è –ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞—Ç
                </h2>
                <p class="fs-5 mb-5" style="text-shadow: 2px 2px 6px rgba(0,0,0,0.7);">
                    üìç –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ –æ—Ç —Ü—è–ª–∞ –ë—ä–ª–≥–∞—Ä–∏—è
                </p>
                <div class="d-flex gap-3 justify-content-center flex-wrap">
                    <div class="text-center">
                        <a href="#filter-section" class="btn btn-success btn-lg hero-btn" style="background-color: #0dd843; border: none;">
                            üü¢ –†–∞–∑–≥–ª–µ–¥–∞–π –ø—Ä–æ–¥—É–∫—Ç–∏
                        </a>
                        <p class="mt-2 mb-0" style="font-size: 0.9rem; color: rgba(255,255,255,0.85); text-shadow: 1px 1px 4px rgba(0,0,0,0.6);">
                            –í–∏–∂ –æ–±—è–≤–∏ –æ—Ç —Ö–æ—Ä–∞ –æ—Ç —Ç–≤–æ—è —Ä–∞–π–æ–Ω
                        </p>
                    </div>
                    <div class="text-center">
                        {% if user.is_authenticated %}
                            <a href="{% url 'catalog:product_create' %}" class="btn btn-warning btn-lg hero-btn">
                                üü† –ü—É–±–ª–∏–∫—É–≤–∞–π –æ–±—è–≤–∞
                            </a>
                        {% else %}
                            <a href="{% url 'account_login' %}" class="btn btn-warning btn-lg hero-btn">
                                üü† –ü—É–±–ª–∏–∫—É–≤–∞–π –æ–±—è–≤–∞
                            </a>
                        {% endif %}
                        <p class="mt-2 mb-0" style="font-size: 0.9rem; color: rgba(255,255,255,0.85); text-shadow: 1px 1px 4px rgba(0,0,0,0.6);">
                            –ö–∞—á–∏ –æ–±—è–≤–∞ –∑–∞ 2 –º–∏–Ω—É—Ç–∏ ‚Äì –±–µ–∑–ø–ª–∞—Ç–Ω–æ
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- How It Works Section -->
    <section class="py-5" style="background: linear-gradient(to bottom, #65ef75 0%, #d4f5e5 50%, #00ffd0 100%);">
        <div class="container">
            <h2 class="text-center mb-5" style="color: #333; font-weight: 600; font-size: 1.8rem;">–ö–∞–∫ —Å—Ç–∞–≤–∞ –∑–∞ 3 –ª–µ—Å–Ω–∏ —Å—Ç—ä–ø–∫–∏</h2>
            <div class="row g-5">
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <div class="mb-3" style="font-size: 2rem; color: #0dd843;">1</div>
                        <h5 class="mb-3" style="color: #333; font-weight: 500; font-size: 1.1rem;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h5>
                        <p style="color: #666; line-height: 1.7; font-size: 0.95rem;">
                            –° –∏–º–µ–π–ª –∏–ª–∏ Google ‚Äì —Å—Ç–∞–≤–∞ –∑–∞ —Å–µ–∫—É–Ω–¥–∏
                        </p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <div class="mb-3" style="font-size: 2rem; color: #0dd843;">2</div>
                        <h5 class="mb-3" style="color: #333; font-weight: 500; font-size: 1.1rem;">–ü—É–±–ª–∏–∫—É–≤–∞–Ω–µ –Ω–∞ –æ–±—è–≤–∞</h5>
                        <p style="color: #666; line-height: 1.7; font-size: 0.95rem;">
                            –°–Ω–∏–º–∫–∞, –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Ü–µ–Ω–∞
                        </p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <div class="mb-3" style="font-size: 2rem; color: #0dd843;">3</div>
                        <h5 class="mb-3" style="color: #333; font-weight: 500; font-size: 1.1rem;">–î–∏—Ä–µ–∫—Ç–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç</h5>
                        <p style="color: #666; line-height: 1.7; font-size: 0.95rem;">
                            –ö—É–ø—É–≤–∞—á–∏—Ç–µ —Å–µ —Å–≤—ä—Ä–∑–≤–∞—Ç —Å —Ç–µ–± –¥–∏—Ä–µ–∫—Ç–Ω–æ
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PWA Install Banner -->
    <div id="installBanner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-banner-content">
            <div class="pwa-banner-text">
                <strong>üì± –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ</strong>
                <p class="mb-0">–ü–æ–ª–∑–≤–∞–π —Å–∞–π—Ç–∞ –∫–∞—Ç–æ –º–æ–±–∏–ª–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –ø–æ-–±—ä—Ä–∑–æ, –±–µ–∑ –±—Ä–∞—É–∑—ä—Ä!</p>
            </div>
            <div class="pwa-banner-buttons">
                <button id="closeBanner" class="btn btn-sm btn-outline-secondary">–ù–µ</button>
                <button id="installApp" class="btn btn-sm btn-success">–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π</button>
            </div>
        </div>
    </div>

    <style>
        .pwa-install-banner {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            padding: 20px;
            z-index: 9998;
            max-width: 500px;
            width: 90%;
            animation: slideDownBanner 0.4s ease-out;
        }
        @keyframes slideDownBanner {
            from { opacity: 0; transform: translate(-50%, -20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        .pwa-banner-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .pwa-banner-text {
            flex: 1;
            min-width: 200px;
        }
        .pwa-banner-text strong {
            color: #0dd843;
            font-size: 16px;
        }
        .pwa-banner-text p {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
        .pwa-banner-buttons {
            display: flex;
            gap: 10px;
        }
        @media (max-width: 576px) {
            .pwa-install-banner {
                top: 60px;
                padding: 15px;
            }
            .pwa-banner-content {
                flex-direction: column;
                text-align: center;
            }
            .pwa-banner-buttons {
                width: 100%;
                justify-content: center;
            }
        }
    </style>

    <div class="container mt-5">

        

            <div class="filter-section" id="filter-section">
            <h5 class="mb-3">–§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏:</h5>
            <form id="filter-form" method="get" action="{% url 'catalog:product_list' %}" onsubmit="removeEmptyParams(event)">
                <!-- –†–µ–¥ 1: –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è -->
                <div class="row g-3 mb-3">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                    <div class="col-md-6">
                        <label for="category-filter-select" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" data-select="category-filter-select">
                                <span class="custom-select-text">–í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                            </div>
                            <div class="custom-options">
                                <div class="custom-option" data-value="">–í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                                {% for cat in categories %}
                                <div class="custom-option {% if selected_parent_category == cat.id|stringformat:"s" %}selected{% endif %}" data-value="{{ cat.id }}">{{ cat.name }}</div>
                                {% endfor %}
                            </div>
                        </div>
                        <select id="category-filter-select" name="parent_category" class="form-select" style="display: none;">
                            <option value="">–í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            {% for cat in categories %}
                            <option value="{{ cat.id }}" {% if selected_parent_category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è -->
                    <div class="col-md-6">
                        <label for="subcategory-filter-select" class="form-label">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" data-select="subcategory-filter-select">
                                <span class="custom-select-text">–í—Å–∏—á–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                            </div>
                            <div class="custom-options">
                                <div class="custom-option" data-value="">–í—Å–∏—á–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                            </div>
                        </div>
                        <select id="subcategory-filter-select" name="category" class="form-select" style="display: none;">
                            <option value="">–í—Å–∏—á–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        </select>
                    </div>
                </div>

                <!-- –†–µ–¥ 2: –û–±–ª–∞—Å—Ç –∏ –ù–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ -->
                <div class="row g-3 mb-3">
                    <!-- –û–±–ª–∞—Å—Ç -->
                    <div class="col-md-6">
                        <label for="region-select" class="form-label">–û–±–ª–∞—Å—Ç</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" data-select="region-select">
                                <span class="custom-select-text">–í—Å–∏—á–∫–∏ –æ–±–ª–∞—Å—Ç–∏</span>
                            </div>
                            <div class="custom-options">
                                <div class="custom-option" data-value="">–í—Å–∏—á–∫–∏ –æ–±–ª–∞—Å—Ç–∏</div>
                                {% for region in regions %}
                                <div class="custom-option {% if selected_region == region.id|stringformat:"s" %}selected{% endif %}" data-value="{{ region.id }}">{{ region.name }}</div>
                                {% endfor %}
                            </div>
                        </div>
                        <select id="region-select" name="region" class="form-select" style="display: none;">
                            <option value="">–í—Å–∏—á–∫–∏ –æ–±–ª–∞—Å—Ç–∏</option>
                            {% for region in regions %}
                            <option value="{{ region.id }}" {% if selected_region == region.id|stringformat:"s" %}selected{% endif %}>{{ region.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- –ì—Ä–∞–¥ -->
                    <div class="col-md-6">
                        <label for="city-select" class="form-label">–ù–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" data-select="city-select">
                                <span class="custom-select-text">–í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ</span>
                            </div>
                            <div class="custom-options">
                                <div class="custom-option" data-value="">–í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ</div>
                            </div>
                        </div>
                        <select id="city-select" name="city" class="form-select" style="display: none;">
                            <option value="">–í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ</option>
                        </select>
                    </div>
                </div>

                <!-- –†–µ–¥ 3: –¢–∏–ø –ø—Ä–æ–¥–∞–≤–∞—á –∏ –ü—Ä–æ–¥–∞–≤–∞ –Ω–∞ -->
                <div class="row g-3 mb-3">
                    <!-- –¢–∏–ø –ø—Ä–æ–¥–∞–≤–∞—á -->
                    <div class="col-md-6">
                        <label for="seller-type-select" class="form-label">–¢–∏–ø –ø—Ä–æ–¥–∞–≤–∞—á</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" data-select="seller-type-select">
                                <span class="custom-select-text">–í—Å–∏—á–∫–∏</span>
                            </div>
                            <div class="custom-options">
                                <div class="custom-option" data-value="">–í—Å–∏—á–∫–∏</div>
                                {% for value, label in seller_type_choices %}
                                <div class="custom-option {% if selected_seller_type == value %}selected{% endif %}" data-value="{{ value }}">{{ label }}</div>
                                {% endfor %}
                            </div>
                        </div>
                        <select id="seller-type-select" name="seller_type" class="form-select" style="display: none;">
                            <option value="">–í—Å–∏—á–∫–∏</option>
                            {% for value, label in seller_type_choices %}
                            <option value="{{ value }}" {% if selected_seller_type == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- –ü—Ä–æ–¥–∞–≤–∞ –Ω–∞ (multi-select) -->
                    <div class="col-md-6">
                        <label class="form-label">–ü—Ä–æ–¥–∞–≤–∞ –Ω–∞</label>
                        <div class="d-flex gap-3 mt-2">
                            {% for value, label in sells_to_choices %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="sells_to" value="{{ value }}" id="sells_to_{{ value }}" {% if value in selected_sells_to %}checked{% endif %}>
                                <label class="form-check-label" for="sells_to_{{ value }}">
                                    {{ label }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- –ë—É—Ç–æ–Ω–∏ -->
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <button type="submit" class="btn btn-primary w-100">–§–∏–ª—Ç—Ä–∏—Ä–∞–π</button>
                    </div>
                    <div class="col-md-6">
                        <a href="{% url 'catalog:product_list' %}" class="btn btn-outline-secondary w-100">–ò–∑—á–∏—Å—Ç–∏</a>
                    </div>
                </div>
            </form>
            
            <!-- –°–æ—Ä—Ç–∏—Ä–∞–Ω–µ -->
            <div class="mt-3 d-flex align-items-center gap-2">
                <label for="sort-select" class="form-label mb-0 fw-bold">–°–æ—Ä—Ç–∏—Ä–∞–π:</label>
                <select id="sort-select" class="form-select w-auto" style="border-radius: 10px; border: 2px solid #0dd843;">
                    <option value="-created_at" {% if sort_by == "-created_at" %}selected{% endif %}>–ù–∞–π-–Ω–æ–≤–∏</option>
                    <option value="created_at" {% if sort_by == "created_at" %}selected{% endif %}>–ù–∞–π-—Å—Ç–∞—Ä–∏</option>
                    <option value="price" {% if sort_by == "price" %}selected{% endif %}>–¶–µ–Ω–∞: –Ω–∏—Å–∫–∞ –∫—ä–º –≤–∏—Å–æ–∫–∞</option>
                    <option value="-price" {% if sort_by == "-price" %}selected{% endif %}>–¶–µ–Ω–∞: –≤–∏—Å–æ–∫–∞ –∫—ä–º –Ω–∏—Å–∫–∞</option>
                </select>
            </div>

            <script>
                // Custom Select Functionality
                document.querySelectorAll('.custom-select').forEach(select => {
                    const wrapper = select.closest('.custom-select-wrapper');
                    const options = wrapper.querySelector('.custom-options');
                    const text = select.querySelector('.custom-select-text');
                    const hiddenSelect = document.getElementById(select.dataset.select);
                    
                    // Set initial text from selected option
                    const selectedOption = options.querySelector('.custom-option.selected');
                    if (selectedOption) {
                        text.textContent = selectedOption.textContent;
                    }
                    
                    // Toggle dropdown
                    select.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // Close other dropdowns
                        document.querySelectorAll('.custom-options.show').forEach(opt => {
                            if (opt !== options) opt.classList.remove('show');
                        });
                        document.querySelectorAll('.custom-select.active').forEach(sel => {
                            if (sel !== select) sel.classList.remove('active');
                        });
                        options.classList.toggle('show');
                        select.classList.toggle('active');
                    });
                    
                    // Select option
                    options.querySelectorAll('.custom-option').forEach(option => {
                        option.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const value = option.dataset.value;
                            const optionText = option.textContent;
                            
                            // Update text and hidden select
                            text.textContent = optionText;
                            hiddenSelect.value = value;
                            
                            // Update selected class
                            options.querySelectorAll('.custom-option').forEach(opt => opt.classList.remove('selected'));
                            option.classList.add('selected');
                            
                            // Close dropdown
                            options.classList.remove('show');
                            select.classList.remove('active');
                            
                            // Trigger change event
                            hiddenSelect.dispatchEvent(new Event('change'));
                        });
                    });
                });
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', () => {
                    document.querySelectorAll('.custom-options.show').forEach(opt => opt.classList.remove('show'));
                    document.querySelectorAll('.custom-select.active').forEach(sel => sel.classList.remove('active'));
                });
                
                // Sort dropdown change handler
                document.getElementById('sort-select').addEventListener('change', function() {
                    const url = new URL(window.location.href);
                    url.searchParams.set('sort', this.value);
                    window.location.href = url.toString();
                });
                
                // Remove empty parameters from form submission
                function removeEmptyParams(event) {
                    const form = event.target;
                    const inputs = form.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        // Remove empty values before submit
                        if (!input.value || input.value === '') {
                            input.removeAttribute('name');
                        }
                    });
                }
                
                // Original filter script
                (function(){
                    const categorySelect = document.getElementById('category-filter-select');
                    const subcategorySelect = document.getElementById('subcategory-filter-select');
                    const regionSelect = document.getElementById('region-select');
                    const citySelect = document.getElementById('city-select');
                    const apiSubcategoriesUrl = '{% url "catalog:api_subcategories" %}';
                    const apiCitiesUrl = '{% url "catalog:api_cities" %}';
                    
                    const selectedCategoryId = '{{ selected_category }}';
                    const selectedCityId = '{{ selected_city }}';

                    // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º—è–Ω–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                    categorySelect.addEventListener('change', function(){
                        const categoryId = this.value;
                        subcategorySelect.innerHTML = '<option value="">–í—Å–∏—á–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
                        
                        // Find custom dropdown elements directly by label (subcategory wrapper)
                        const subcatLabel = document.querySelector('label[for="subcategory-filter-select"]');
                        const subcatWrapper = subcatLabel.nextElementSibling;
                        const customSubcatSelect = subcatWrapper.querySelector('.custom-select');
                        const customSubcatOptions = subcatWrapper.querySelector('.custom-options');
                        const customSubcatText = customSubcatSelect.querySelector('.custom-select-text');
                        
                        customSubcatOptions.innerHTML = '';
                        
                        // Add "All" option with event listener
                        const allOption = document.createElement('div');
                        allOption.className = 'custom-option';
                        allOption.dataset.value = '';
                        allOption.textContent = '–í—Å–∏—á–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                        allOption.addEventListener('click', (e) => {
                            e.stopPropagation();
                            customSubcatOptions.querySelectorAll('.custom-option').forEach(o => o.classList.remove('selected'));
                            allOption.classList.add('selected');
                            customSubcatText.textContent = '–í—Å–∏—á–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                            subcategorySelect.value = '';
                            customSubcatOptions.classList.remove('show');
                            customSubcatSelect.classList.remove('active');
                        });
                        customSubcatOptions.appendChild(allOption);
                        customSubcatText.textContent = '–í—Å–∏—á–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                        
                        if(!categoryId) return;
                        fetch(apiSubcategoriesUrl + '?category=' + categoryId)
                            .then(res => res.json())
                            .then(data => {
                                data.forEach(sc => {
                                    const opt = document.createElement('option');
                                    opt.value = sc.id;
                                    opt.textContent = sc.name;
                                    if(sc.id == selectedCategoryId) {
                                        opt.selected = true;
                                    }
                                    subcategorySelect.appendChild(opt);
                                    
                                    // Add to custom dropdown
                                    const customOpt = document.createElement('div');
                                    customOpt.className = 'custom-option';
                                    customOpt.dataset.value = sc.id;
                                    customOpt.textContent = sc.name;
                                    if(sc.id == selectedCategoryId) {
                                        customOpt.classList.add('selected');
                                        customSubcatText.textContent = sc.name;
                                    }
                                    customOpt.addEventListener('click', (e) => {
                                        e.stopPropagation();
                                        customSubcatOptions.querySelectorAll('.custom-option').forEach(o => o.classList.remove('selected'));
                                        customOpt.classList.add('selected');
                                        customSubcatText.textContent = sc.name;
                                        subcategorySelect.value = sc.id;
                                        customSubcatOptions.classList.remove('show');
                                        customSubcatSelect.classList.remove('active');
                                    });
                                    customSubcatOptions.appendChild(customOpt);
                                });
                            }).catch(err => console.error(err));
                    });

                    // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≥—Ä–∞–¥–æ–≤–µ –ø—Ä–∏ —Å–º—è–Ω–∞ –Ω–∞ —Ä–µ–≥–∏–æ–Ω
                    regionSelect.addEventListener('change', function(){
                        const regionId = this.value;
                        citySelect.innerHTML = '<option value="">–í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ</option>';
                        
                        // Find custom dropdown elements directly by label (city wrapper)
                        const cityLabel = document.querySelector('label[for="city-select"]');
                        const cityWrapper = cityLabel.nextElementSibling;
                        const customCitySelect = cityWrapper.querySelector('.custom-select');
                        const customCityOptions = cityWrapper.querySelector('.custom-options');
                        const customCityText = customCitySelect.querySelector('.custom-select-text');
                        
                        customCityOptions.innerHTML = '';
                        
                        // Add "All" option with event listener
                        const allOption = document.createElement('div');
                        allOption.className = 'custom-option';
                        allOption.dataset.value = '';
                        allOption.textContent = '–í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ';
                        allOption.addEventListener('click', (e) => {
                            e.stopPropagation();
                            customCityOptions.querySelectorAll('.custom-option').forEach(o => o.classList.remove('selected'));
                            allOption.classList.add('selected');
                            customCityText.textContent = '–í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ';
                            citySelect.value = '';
                            customCityOptions.classList.remove('show');
                            customCitySelect.classList.remove('active');
                        });
                        customCityOptions.appendChild(allOption);
                        customCityText.textContent = '–í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ';
                        
                        if(!regionId) return;
                        fetch(apiCitiesUrl + '?region=' + regionId)
                            .then(res => res.json())
                            .then(data => {
                                data.forEach(c => {
                                    const opt = document.createElement('option');
                                    opt.value = c.id;
                                    opt.textContent = c.name;
                                    if(c.id == selectedCityId) {
                                        opt.selected = true;
                                    }
                                    citySelect.appendChild(opt);
                                    
                                    // Add to custom dropdown
                                    const customOpt = document.createElement('div');
                                    customOpt.className = 'custom-option';
                                    customOpt.dataset.value = c.id;
                                    customOpt.textContent = c.name;
                                    if(c.id == selectedCityId) {
                                        customOpt.classList.add('selected');
                                        customCityText.textContent = c.name;
                                    }
                                    customOpt.addEventListener('click', (e) => {
                                        e.stopPropagation();
                                        customCityOptions.querySelectorAll('.custom-option').forEach(o => o.classList.remove('selected'));
                                        customOpt.classList.add('selected');
                                        customCityText.textContent = c.name;
                                        citySelect.value = c.id;
                                        customCityOptions.classList.remove('show');
                                        customCitySelect.classList.remove('active');
                                    });
                                    customCityOptions.appendChild(customOpt);
                                });
                            }).catch(err => console.error(err));
                    });

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                    if(categorySelect.value) {
                        categorySelect.dispatchEvent(new Event('change'));
                    }
                    if(regionSelect.value) {
                        regionSelect.dispatchEvent(new Event('change'));
                    }

                    // –°–∫—Ä–æ–ª–≤–∞–Ω–µ –¥–æ –ø—Ä–æ–¥—É–∫—Ç–∏—Ç–µ –ø—Ä–∏ —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ
                    const urlParams = new URLSearchParams(window.location.search);
                    if(urlParams.has('parent_category') || urlParams.has('category') || urlParams.has('region') || urlParams.has('city') || urlParams.has('search')) {
                        setTimeout(function() {
                            document.getElementById('filter-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    }
                })();
                
                // Scroll to results on search form submit
                document.getElementById('search-form').addEventListener('submit', function() {
                    setTimeout(function() {
                        document.getElementById('filter-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                });
            </script>
        </div>
        <div id="products">
            {% if products %}
            <h3 class="mb-4 text-secondary">–ü—Ä–æ–¥—É–∫—Ç–∏</h3>
            <div class="row g-4">
                {% for product in products %}
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <a href="{% url 'catalog:product_detail' product.pk %}" style="text-decoration: none; color: inherit;">
                        <div class="card product-card h-100">
                            {% if product.get_first_image %}<img src="{{ product.get_first_image.url }}" alt="{{ product.title }}" class="product-image" loading="lazy">
                            {% else %}<div class="product-image d-flex align-items-center justify-content-center"><span style="font-size: 48px; color: #ccc;">üì¶</span></div>{% endif %}
                            <div class="card-body">
                                <span class="category-badge">{{ product.category.name }}</span>
                                <h5 class="card-title">{{ product.title }}</h5>
                                <p class="card-text small">{{ product.description|truncatewords:8 }}</p>
                                <div class="price">{{ product.price }} ‚Ç¨</div>
                                {% if product.city %}<p class="card-text small" style="opacity: 0.7;">üìç {{ product.city.name }}, {{ product.city.region.name }}</p>{% endif %}
                            </div>
                            <div class="card-footer border-0" style="background-color: rgba(0,0,0,0.05);">
                                <small style="opacity: 0.7;">–î–æ–±–∞–≤–µ–Ω–æ: {{ product.created_at|date:"d.m.Y" }}</small>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>

            {% if is_paginated %}
            <nav aria-label="Page navigation" class="mt-5">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_parent_category %}&parent_category={{ selected_parent_category }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_region %}&region={{ selected_region }}{% endif %}{% if selected_city %}&city={{ selected_city }}{% endif %}#filter-section">–ü—ä—Ä–≤–∞</a></li>
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_parent_category %}&parent_category={{ selected_parent_category }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_region %}&region={{ selected_region }}{% endif %}{% if selected_city %}&city={{ selected_city }}{% endif %}#filter-section">–ü—Ä–µ–¥–∏—à–Ω–∞</a></li>
                    {% endif %}
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}<li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}<li class="page-item"><a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_parent_category %}&parent_category={{ selected_parent_category }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_region %}&region={{ selected_region }}{% endif %}{% if selected_city %}&city={{ selected_city }}{% endif %}#filter-section">{{ num }}</a></li>{% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_parent_category %}&parent_category={{ selected_parent_category }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_region %}&region={{ selected_region }}{% endif %}{% if selected_city %}&city={{ selected_city }}{% endif %}#filter-section">–°–ª–µ–¥–≤–∞—â–∞</a></li>
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_parent_category %}&parent_category={{ selected_parent_category }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_region %}&region={{ selected_region }}{% endif %}{% if selected_city %}&city={{ selected_city }}{% endif %}#filter-section">–ü–æ—Å–ª–µ–¥–Ω–∞</a></li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
            {% else %}
            <div class="alert alert-info text-center py-5"><h4>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</h4><p>–û–ø–∏—Ç–∞–π—Ç–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ –∏–ª–∏ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ.</p></div>
            {% endif %}
        </div>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookieConsent" class="cookie-consent" style="display: none;">
        <div class="cookie-consent-content">
            <p class="mb-2">
                <strong>üç™ –ë–∏—Å–∫–≤–∏—Ç–∫–∏ (Cookies)</strong><br>
                –ò–∑–ø–æ–ª–∑–≤–∞–º–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏ –±–∏—Å–∫–≤–∏—Ç–∫–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞ –Ω–∞ —Å–∞–π—Ç–∞ (–≤—Ö–æ–¥, —Ñ–æ—Ä–º—É–ª—è—Ä–∏, —Å–∏–≥—É—Ä–Ω–æ—Å—Ç) –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–Ω–∏ –±–∏—Å–∫–≤–∏—Ç–∫–∏ (Google Analytics) –∑–∞ –ø–æ–¥–æ–±—Ä—è–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ—Ç–æ –∏–∑–∂–∏–≤—è–≤–∞–Ω–µ.
            </p>
            <div class="cookie-consent-buttons">
                <a href="{% url 'catalog:cookie_policy' %}" class="btn btn-sm btn-outline-light me-2">–ù–∞—É—á–∏ –ø–æ–≤–µ—á–µ</a>
                <button id="acceptCookies" class="btn btn-sm btn-success">–†–∞–∑–±—Ä–∞—Ö</button>
            </div>
        </div>
    </div>

    <style>
        .cookie-consent {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .cookie-consent-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .cookie-consent-content p {
            flex: 1;
            min-width: 300px;
            margin: 0;
        }
        .cookie-consent-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        @media (max-width: 768px) {
            .cookie-consent-content {
                flex-direction: column;
                text-align: center;
            }
            .cookie-consent-content p {
                min-width: 100%;
            }
            .cookie-consent-buttons {
                justify-content: center;
                width: 100%;
            }
        }
    </style>

    <script>
        // Cookie Consent Logic
        document.addEventListener('DOMContentLoaded', function() {
            const cookieConsent = document.getElementById('cookieConsent');
            const acceptButton = document.getElementById('acceptCookies');
            
            // –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –≤–µ—á–µ –∏–º–∞ —Å—ä–≥–ª–∞—Å–∏–µ
            const consentGiven = localStorage.getItem('cookie_consent');
            
            if (!consentGiven) {
                cookieConsent.style.display = 'block';
            }
            
            // –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–µ –Ω–∞ "–†–∞–∑–±—Ä–∞—Ö"
            acceptButton.addEventListener('click', function() {
                localStorage.setItem('cookie_consent', 'true');
                
                // Update Google Consent Mode
                if (typeof gtag === 'function') {
                    gtag('consent', 'update', {
                        'analytics_storage': 'granted'
                    });
                }
                
                cookieConsent.style.animation = 'slideDown 0.3s ease-in';
                setTimeout(() => {
                    cookieConsent.style.display = 'none';
                }, 300);
            });
        });
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞ —Å–∫—Ä–∏–≤–∞–Ω–µ
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translateY(0); opacity: 1; }
                to { transform: translateY(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>

    <!-- PWA Install Script -->
    <script src="{% static 'js/pwa-install.js' %}"></script>
    
    <!-- PWA Install Navbar Button Script -->
    <script>
        let deferredPrompt;
        const installButton = document.getElementById('installAppNavbar');
        
        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
            installButton.style.display = 'none';
            console.log('PWA already installed');
        } else {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.log('PWA install available');
            });
            
            installButton.addEventListener('click', async () => {
                console.log('Install button clicked, deferredPrompt:', deferredPrompt);
                
                if (!deferredPrompt) {
                    alert('–ó–∞ –¥–∞ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:\n\n' +
                          '1. –û—Ç–≤–æ—Ä–µ—Ç–µ —Å–∞–π—Ç–∞ –≤ Chrome –∏–ª–∏ Edge –±—Ä–∞—É–∑—ä—Ä\n' +
                          '2. –°–∞–π—Ç—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –Ω–∞ HTTPS\n' +
                          '3. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –≤–µ—á–µ –Ω–µ –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–æ\n\n' +
                          '–ù–∞ iOS: –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Safari > Share > Add to Home Screen');
                    return;
                }
                
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    console.log('User choice:', outcome);
                    
                    if (outcome === 'accepted') {
                        console.log('PWA installed from navbar');
                        installButton.style.display = 'none';
                    }
                    
                    deferredPrompt = null;
                } catch (error) {
                    console.error('Install error:', error);
                    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ: ' + error.message);
                }
            });
            
            window.addEventListener('appinstalled', () => {
                console.log('PWA installed');
                installButton.style.display = 'none';
            });
        }
    </script>

    <script>
        // Dark Mode Toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.querySelector('.dark-mode-icon');
        const html = document.documentElement;
        
        // Check for saved theme preference
        const currentTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', currentTheme);
        if (darkModeIcon) {
            darkModeIcon.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }
        
        if (darkModeToggle) {
            darkModeToggle.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                if (darkModeIcon) {
                    darkModeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
            });
        }
        
        // Sticky Navigation on Scroll
        const navbar = document.querySelector('.navbar');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 100) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });
        
        // Enhanced Product Card Animations
        document.querySelectorAll('.product-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px) scale(1.02)';
            });
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
    </script>

    <footer style="background: var(--footer-bg); color: white; margin-top: 5rem; padding: 3rem 0 1.5rem;">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-4 col-md-6">
                    <h5 class="mb-3" style="color: var(--primary-color); font-weight: 700;">üçÉ –ë–ì –•—Ä–∞–Ω–∞</h5>
                    <p style="color: rgba(255,255,255,0.7); line-height: 1.6;">
                        –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∞ —Ö—Ä–∞–Ω–∞ –∏ –æ—Ä–≥–∞–Ω–∏—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è. –ö–∞—á–µ—Å—Ç–≤–æ –∏ —Å–≤–µ–∂–µ—Å—Ç –Ω–∞ –µ–¥–Ω–∞ —Ä—ä–∫–∞ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ.
                    </p>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h6 class="mb-3" style="color: var(--primary-color); font-weight: 600;">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'catalog:product_list' %}" style="color: rgba(255,255,255,0.7); text-decoration: none; transition: color 0.3s;">–ù–∞—á–∞–ª–æ</a></li>
                        <li class="mb-2"><a href="{% url 'catalog:about' %}" style="color: rgba(255,255,255,0.7); text-decoration: none; transition: color 0.3s;">–ó–∞ –Ω–∞—Å</a></li>
                        <li class="mb-2"><a href="{% url 'catalog:contact' %}" style="color: rgba(255,255,255,0.7); text-decoration: none; transition: color 0.3s;">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h6 class="mb-3" style="color: var(--primary-color); font-weight: 600;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'catalog:terms' %}" style="color: rgba(255,255,255,0.7); text-decoration: none; transition: color 0.3s;">–û–±—â–∏ —É—Å–ª–æ–≤–∏—è</a></li>
                        <li class="mb-2"><a href="{% url 'catalog:cookie_policy' %}" style="color: rgba(255,255,255,0.7); text-decoration: none; transition: color 0.3s;">–ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞ –±–∏—Å–∫–≤–∏—Ç–∫–∏</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h6 class="mb-3" style="color: var(--primary-color); font-weight: 600;">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h6>
                    <p style="color: rgba(255,255,255,0.7); line-height: 1.8; margin: 0;">
                        üìç –ë—ä–ª–≥–∞—Ä–∏—è<br>
                        üìß support@bghrana.com
                    </p>
                    <a href="https://www.facebook.com/profile.php?id=61586589757503" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: none; display: inline-flex; align-items: center; gap: 8px; margin-top: 12px; font-weight: 500; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
                        </svg>
                        –ü–æ—Å–ª–µ–¥–≤–∞–π –Ω–∏ –≤—ä–≤ Facebook
                    </a>
                </div>
            </div>
            <hr style="border-color: rgba(255,255,255,0.1); margin: 2rem 0 1rem;">
            <div class="text-center" style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">
                <p class="mb-0">&copy; 2026 –ë–ì –•—Ä–∞–Ω–∞. –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
            </div>
        </div>
    </footer>
</body>
</html>